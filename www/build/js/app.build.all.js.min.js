var AppModule=function(){return{groupName:null,requireList:[],nameList:[],typeList:[],paramsList:[],actionList:[],group:function(a){return this.groupName=a,this},require:function(a){return this.requireList=a,this},name:function(a){return this.nameList.push(a),this},type:function(a){return this.typeList.push(a),this},params:function(a){return this.paramsList.push(a),this},action:function(a){return this.actionList.push(a),this},build:function(){for(var a=angular.module(this.groupName,this.requireList);this.nameList.length>0;){var b=this.nameList.pop(),c=this.typeList.pop(),d=this.actionList.pop(),e=this.paramsList.pop();e.push(d),"controller"==c?a=a.controller(b,e):"service"==c?a=a.factory(b,e):"provider"==c?a=a.provider(b,e):"filter"==c&&(a=a.filter(b,e))}}}},AppStarter=function(){return{groupName:"",requireList:[],defaultUrlList:[],listenerList:{},homePartnerList:[],name:function(a){return this.groupName=a,this},require:function(a){return this.requireList=a,this},defaultUrl:function(a){return this.defaultUrlList=a,this},listeners:function(a){return this.listenerList=a,this},homePartners:function(a){return this.homePartnerList=a,this},_registListeners:function(a,b){var c=this;a.$on("$stateChangeStart",function(d,e,f,g,h){var i=APP_SYSTEM_HELPER.getService("app.framework.cache.service","AppCacheService"),j=c.listenerList.onStateChangeStart;void 0!=j&&j({event:d,toState:e,toParams:f,fromState:g,fromParams:h,rootScope:a,state:b,AppCacheService:i})})},build:function(){var a=this;angular.module(this.groupName,this.requireList).constant("ApiEndpoint",{url:"http://localhost:8100/api"}).run(["$ionicPlatform","$rootScope","$location","AppMessageService","$state","$ionicHistory","AppListenerService","AppHttpService","$ionicLoading","$timeout","AppUtilsService",function(b,c,d,e,f,g,h,i,j,k,l){c.showTab=!0,c.platform=ionic.Platform.platform(),a._registListeners&&a._registListeners(c,f);var m={urlParams:d.search(),AppMessageService:e,AppListenerService:h,AppUtilsService:l};null!=a.listenerList.onInit&&a.listenerList.onInit(m),b.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0));try{"android"==c.platform?StatusBar.backgroundColorByHexString("#333"):(StatusBar.overlaysWebView(!1),StatusBar.styleLightContent(),StatusBar.backgroundColorByHexString("#fff"))}catch(b){}l.updateVersion(),void 0!=navigator.splashscreen&&navigator.splashscreen.hide();try{window.open=cordova.InAppBrowser.open}catch(b){}window.StatusBar&&StatusBar.styleDefault(),void 0!=a.listenerList.onFinish&&a.listenerList.onFinish(m)});var n=!1;b.registerBackButtonAction(function(b){b.preventDefault();var c=f.current.name,d=h.queryHandler(c,LISTENER_TYPES.DEVICE.BACK_BUTTON);if(null!=d){var i=!0;if(d.action({stopAction:function(){i=!1}}),!i)return}-1!=a.defaultUrlList.indexOf(c)?n?ionic.Platform.exitApp():(n=!0,e.appToast({content:"再次单击退出应用",duration:2e3}),k(function(){n=!1},2e3)):-1!=a.homePartnerList.indexOf(c)?f.go(a.defaultUrlList[0]):g.goBack()},501)}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(b,c,d){d.tabs.position("bottom"),d.tabs.style("standard"),d.backButton.text(""),d.backButton.previousTitleText(!1),d.scrolling.jsScrolling(!0),d.backButton.icon("ion-chevron-left back-btn"),d.views.maxCache(10),d.views.swipeBackEnabled(!1);var e=APP_ROUTER.getTables();for(var f in e){var g=e[f];for(var h in g)b.state(h,g[h])}c.otherwise(a.defaultUrlList[0])}])}}},APP_SYSTEM_HELPER={getService:function(a,b){return angular.injector([a]).get(b)}},LISTENER_TYPES={VIEWS:{},DEVICE:{BACK_BUTTON:"backButton"}};angular.module("app.framework.listPicker.directive",["app.framework.listPicker.service"]).directive("appListPickerDirective",["AppMessageService","AppListPickerService","$ionicScrollDelegate",function(a,b,c){return{scope:{title:"@",cancelText:"@",okText:"@",data:"=",selectFinish:"&",bind:"&"},templateUrl:"framework/js/directive/list_picker/template/list_picker.html",replace:!0,restrict:"A",controller:["$scope",function(a){a.id=(new Date).getTime(),a.show=function(){void 0==a.title&&(a.title="请选择"),c.$getByHandle("pickerScroller").scrollTop(),b.showPicker(a.id)},a.itemClick=function(c){a.selectFinish({params:{item:b.getItemByValue(a.data,c)}}),a.hide()},a.hide=function(){b.hidePicker(a.id)},a.bind({params:a})}]}}]),(new AppModule).group("app.framework.listPicker.service").require([]).type("service").name("AppListPickerService").params(["$state","$timeout","$rootScope"]).action(function(a,b,c){return{showPicker:function(b){var d=angular.element(document.getElementById("picker_"+b)),e=angular.element(document.getElementById("picker_mask_"+b));d.removeClass("framework-picker-down"),e.css("display","block"),e.css("opacity",.7),d.css("display","block"),d.addClass("framework-picker-up"),e.removeClass("framework-picker-mask-hide"),e.addClass("framework-picker-mask-show"),a.current.name.indexOf("_tab")>-1&&(c.showTab=!1)},hidePicker:function(d){var e=angular.element(document.getElementById("picker_"+d)),f=angular.element(document.getElementById("picker_mask_"+d));e.removeClass("framework-picker-up"),e.addClass("framework-picker-down"),f.removeClass("framework-picker-mask-show"),f.addClass("framework-picker-mask-hide"),b(function(){e.css("display","none"),f.css("display","none")},490),b(function(){a.current.name.indexOf("_tab")>-1&&(c.showTab=!0)},350)},getItemByValue:function(a,b){for(var c in a)if(a[c].value==b)return a[c];return{}}}}).build();var MEMORY_CACHE={userInfo:{},token:""};(new AppModule).group("app.framework.cache.service").require([]).type("service").name("AppCacheService").params([]).action(function(){return{setMemoryCache:function(a,b){MEMORY_CACHE[a]=b},getMemoryCache:function(a){return MEMORY_CACHE[a]},removeMemoryCache:function(a){MEMORY_CACHE[a]=void 0},setStorageCache:function(a,b){var c=angular.toJson(b);localStorage.setItem(a,c)},getStorageCache:function(a){var b=localStorage.getItem(a);return angular.fromJson(b)},removeStorageCache:function(a){localStorage.removeItem(a)}}}).build(),(new AppModule).group("app.framework.http.service").require([]).type("service").name("AppHttpService").params(["$http","AppMessageService"]).action(function($http,AppMessageService){return{isInit:!0,buildUrl:function(a,b){var c=this;if(!b)return a;var d=[];return c._forEachSorted(b,function(a,b){null===a||angular.isUndefined(a)||(angular.isArray(a)||(a=[a]),angular.forEach(a,function(a){angular.isObject(a)&&(a=angular.isDate(a)?a.toISOString():angular.toJson(a)),d.push(c._encodeUriQuery(b)+"="+c._encodeUriQuery(a))}))}),d.length>0&&(a+=(-1==a.indexOf("?")?"?":"&")+d.join("&")),a},_prepareParams:function(a){var b={};if(void 0!=AppConfig.DEFAULT_PARAMS)for(var c in AppConfig.DEFAULT_PARAMS)b[c]=AppConfig.DEFAULT_PARAMS[c];if(void 0!=a)for(var c in a)b[c]=a[c];return b},_forEachSorted:function(a,b,c){for(var d=Object.keys(a).sort(),e=0;e<d.length;e++)b.call(c,a[d[e]],d[e]);return d},_encodeUriQuery:function(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/'/gi,"%27").replace(/%20/g,b?"%20":"+")},isJSONError:function(jsonString){var checkResult=!1;if(void 0==jsonString||null==jsonString||""==jsonString)return checkResult;try{eval("kyee_json_test_result="+jsonString+";"),checkResult=!1}catch(e){checkResult=!0}finally{return checkResult}},_initConfig:function(a){var b=this,c={type:void 0==a.type?"GET":a.type,url:AppConfig.SERVER_URL+a.url,showLoading:void 0==a.showLoading?!0:a.showLoading,autoHideLoading:void 0==a.autoHideLoading?!0:a.autoHideLoading,params:b._prepareParams(a.params),responseType:"json",responseSyntaxCheck:!0,timeout:a.timeout,onBefore:function(b){void 0!=a.onBefore&&a.onBefore(b)},onSuccess:function(b){void 0!=a.onSuccess&&a.onSuccess(b)},onError:function(b){void 0!=a.onError&&a.onError(b)}};if(void 0!=c.params)for(var d in c.params)"function"==typeof c.params[d]&&(c.params[d]=c.params[d]());return c},init:function(){var a=this;$http.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",a.isInit=!1},send:function(cfg){var me=this;me.isInit&&me.init();var config=me._initConfig(cfg);config.url=config.url.replace(/\/\//g,"/").replace("http:/","http://"),config.timeout=void 0==config.timeout?3e4:config.timeout;var type=void 0==config.type?"GET":config.type,httpConfig={method:type,url:config.url,transformRequest:function(a){return"POST"==type?me.buildUrl("",a).substring(1):a},transformResponse:function(a){return a},responseType:"text",timeout:config.timeout};"GET"==type?(httpConfig.url=me.buildUrl(config.url,config.params),httpConfig.urlParamsString=httpConfig.url.substring(httpConfig.url.indexOf("?")+1)):"POST"==type&&(httpConfig.data=config.params),void 0!==config.showLoading&&1==config.showLoading&&-1!=config.url.indexOf("http://")&&AppMessageService.loading({content:cfg.loadingText,mask:!1,duration:cfg.timeout}),void 0!=config.onBefore&&config.onBefore(httpConfig),$http(httpConfig).success(function(data){if(1==config.responseSyntaxCheck&&-1!=config.url.indexOf("http://")){var isError=me.isJSONError(data);if(isError)return console.error("检测到服务器返回结果语法错误，已回调 onError 方法！"),void(void 0!=config.onError&&config.onError("RESPONSE_SYNTAX_ERROR"))}var _data=data;void 0!=config.responseType&&"json"==config.responseType&&(eval("var result="+data+";"),_data=result),void 0!=config.showLoading&&1==config.showLoading&&0!=config.autoHideLoading&&-1!=config.url.indexOf("http://")&&AppMessageService.hideLoading(),void 0!=config.onSuccess&&config.onSuccess(_data)}).error(function(){void 0!=config.showLoading&&1==config.showLoading&&0!=config.autoHideLoading&&-1!=config.url.indexOf("http://")&&AppMessageService.hideLoading(),void 0!=config.onError&&config.onError(config)})}}}).build(),(new AppModule).group("app.framework.listener.service").require([]).type("service").name("AppListenerService").params([]).action(function(){return{ListenerTable:{},onceListenerTable:{},regist:function(a){var b=a.page+"|"+a.when;this.ListenerTable[b]=a},queryHandler:function(a,b){var c=a+"|"+b;return void 0==this.ListenerTable[c]?null:this.ListenerTable[c]},once:function(a){this.onceListenerTable[a.when]=a},uninstallOnce:function(a){this.onceListenerTable[a]=void 0},queryOnceHandler:function(a){return void 0==this.onceListenerTable[a]?null:this.onceListenerTable[a]}}}).build(),(new AppModule).group("app.framework.message.service").require([]).type("service").name("AppMessageService").params(["$ionicPopup","$ionicLoading","$timeout"]).action(function(a,b,c){return{curPopup:null,isAppToastInit:!1,appToastTimeout:null,isPopupShown:function(){var a=this;return null!=a.curPopup&&0==a.curPopup.$$state.status},closePopup:function(){var a=this;null!=a.curPopup&&(a.curPopup.close(),a.curPopup=null)},beforePopupShownAction:function(){var a=this;a.isPopupShown()&&a.closePopup()},_showAppToast:function(a){var b=this,d=0,e=3e3;a.delay&&(d=a.delay),a.duration&&(e=a.duration),c(function(){angular.element(document.getElementById("appToast")).css("display","block"),angular.element(document.getElementById("appToastContent")).html(a.content),angular.element(document.getElementById("appToast")).css("left",window.innerWidth/2-130+"px"),void 0!==a.top&&angular.element(document.getElementById("appToast")).css("top",a.top),null!=b.appToastTimeout&&c.cancel(b.appToastTimeout),b.appToastTimeout=c(function(){angular.element(document.getElementById("appToast")).css("display","none"),b.appToastTimeout=null},e)},d)},appToast:function(a){var b=this;if(!b.isAppToastInit){var c='<div id="appToast" style="position: absolute;top: 50%; margin-top:-16px;width:260px;z-index: 9999;text-align: center;display: none;background-color: black;opacity:0.7;border-radius: 5px;padding: 5px;"><span id="appToastContent" style="color: white;opacity: 1;font-size: 14px;"></span></div>';angular.element(document.body).append(c),b.isAppToastInit=!0}b._showAppToast(a)},confirm:function(b){var c=this;return c.beforePopupShownAction(),c.curPopup=a.confirm({title:b.title?b.title:"消息",template:b.content,okText:b.okText?b.okText:"确定",cancelText:b.cancelText?b.cancelText:"取消"}),c.curPopup.then(function(a){b.onSelect(a)}),c.curPopup},alert:function(b){var c=this;return c.beforePopupShownAction(),c.curPopup=a.alert({title:b.title?b.title:"消息",template:b.content,okText:b.okText?b.okText:"确定"}),b.onSelect&&c.curPopup.then(function(a){b.onSelect(a)}),c.curPopup},dialog:function(b){var c=this;c.beforePopupShownAction();var d=[];for(var e in b.buttons){var f=b.buttons[e];d.push({text:f.text,type:f["class"]?f["class"]:"button-positive",onTap:function(a){f.onSelect&&f.onSelect(a)}})}return c.curPopup=a.show({template:b.content,title:b.title?b.title:"消息",scope:b.scope,buttons:d}),c.curPopup},loading:function(a){var c="";void 0!=a&&void 0!=a.content&&""!=a.content?c+="<div class='row' style='margin:0;padding: 0;'>	 <div class='col' style='margin:0;padding: 0;'><ion-spinner icon='android'></ion-spinner></div></div><div class='row' style='margin:0;'>    <div class='col' style='margin:0;padding: 0;color:#cccccc;'>"+a.content+"</div></div>":c="<ion-spinner icon='android'></ion-spinner>",b.show({template:c,hideOnStateChange:!0,noBackdrop:void 0==a||void 0==a.mask?!1:!a.mask,duration:void 0==a||void 0==a.duration?3e4:a.duration,delay:void 0==a||void 0==a.delay?0:a.delay})},hideLoading:function(){b.hide()}}}).build(),(new AppModule).group("app.framework.utils.service").require([]).type("service").name("AppUtilsService").params(["$interval","AppHttpService","AppMessageService","$ionicLoading"]).action(function(a,b,c,d){return{interval:function(b){return a(b.action,b.time)},cancelInterval:function(b){a.cancel(b)},checkPhoneNum:function(a){if(""===a.trim())return 0;var b=/^(\+86)?1[3|5|4|7|8]\d{9}$/;return b.test(a.trim())?1:-1},updateVersion:function(a){var b=this;try{b._updateVersion(a)}catch(c){}},_updateVersion:function(a){var d=this;cordova.getAppVersion&&cordova.getAppVersion.getVersionNumber().then(function(e){AppConfig.DEFAULT_PARAMS.APP_VERSION=e;var f=ionic.Platform.platform(),g=1;"ios"==f&&(g=2),b.send({url:"index.php?c=Login&f=Init_Version",showLoading:!1,params:{device:g},onSuccess:function(b){if(1e3==b.code)if(b.datas.version>e){var f=b.datas.update_info.split(";"),h="";for(var i in f)h=h+f[i]+";<br/>";c.confirm({content:"检查到最新版本，更新内容为：<br/>"+h+"是否需要升级？",okText:"是",cancelText:"否",onSelect:function(a){a?1==g?d.downLoadApk(b):2==g&&window.open(b.datas.download_url,"_blank","location=yes"):"force"==b.datas.levelUp&&ionic.Platform.exitApp()}})}else a&&a();else c.appToast({content:b.msg})}})})},downLoadApk:function(a){var b="file:///storage/emulated/0/fangao/fangaowuliu.apk",c=new FileTransfer,e=encodeURI(a.datas.download_url);c.download(e,b,function(a){cordova.plugins.fileOpener2.open(b,"application/vnd.android.package-archive",{error:function(a){alert("打开apk失败！")}})},function(a){},!1,{headers:{Authorization:"Basic dGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}}),c.onprogress=function(a){var b=a.loaded/a.total*100;d.show({template:"已经下载："+Math.floor(b)+"%"}),b>99&&d.hide()}}}}).build();var AppConfig={SERVER_URL:"http://localhost:8100/api/",DEFAULT_PARAMS:{APP_VERSION:"0.0.1",token:function(){var a=APP_SYSTEM_HELPER.getService("app.framework.cache.service","AppCacheService");return a.getMemoryCache("token")}}},APP_ROUTER={getTables:function(){return[MAIN_ROUTER,SCHEDULE_ROUTER,ACCOUNT_ROUTER]}},ACCOUNT_ROUTER={account_tab:{url:"/account_tab",views:{main_view:{templateUrl:"business/account/index.html",controller:"AccountCtrl"}}}},MAIN_ROUTER={msg_tab:{url:"/msg_tab",views:{main_view:{templateUrl:"business/main/index.html",controller:"MsgCtrl"}}},msgDetail:{url:"/msgDetail",views:{main_view:{templateUrl:"business/main/views/msg_detail.html",controller:"MsgDetailCtrl"}}}},SCHEDULE_ROUTER={schedule_tab:{url:"/schedule_tab",views:{main_view:{templateUrl:"business/schedule/index.html",controller:"ScheduleCtrl"}}},scheduleDetail:{url:"/scheduleDetail",views:{main_view:{templateUrl:"business/schedule/views/schedule_detail.html",controller:"ScheduleDetailCtrl"}}},scheduleAdd:{url:"/scheduleDetail",views:{main_view:{templateUrl:"business/schedule/views/schedule_add.html",controller:"ScheduleAddCtrl"}}}};(new AppModule).group("app.business.account.controller").require([]).type("controller").name("AccountCtrl").params(["$scope"]).action(function(a){a.settings={enableFriends:!0}}).build(),(new AppModule).group("app.business.msg.controller").require(["app.business.msg.service","app.business.msgDetail.service","app.business.msgDetail.controller"]).type("controller").name("MsgCtrl").params(["$scope","$state","MsgService","MsgDetailService","$http"]).action(function(a,b,c,d,e){c.getList(function(b){a.msgList=b}),a.toDetail=function(a){d.msgInfo=a,b.go("msgDetail")}}).build(),(new AppModule).group("app.business.msgDetail.controller").require([]).type("controller").name("MsgDetailCtrl").params(["$scope","MsgDetailService"]).action(function(a,b){a.msg=b.msgInfo}).build(),(new AppModule).group("app.business.tab.controller").require([]).type("controller").name("TabCtrl").params(["$scope"]).action(function(a){}).build(),(new AppModule).group("app.business.msgDetail.service").require([]).type("service").name("MsgDetailService").params([]).action(function(){return{msgInfo:{}}}).build(),(new AppModule).group("app.business.msg.service").require([]).type("service").name("MsgService").params(["AppHttpService"]).action(function(a){var b=[];return{getList:function(c){a.send({type:"GET",url:"todo/msgList",params:{},onSuccess:function(a){b=a,c(a)},onError:function(){}})},getMsg:function(a){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c];return null}}}).build(),(new AppModule).group("app.business.scheduleAdd.controller").require(["app.business.scheduleAdd.service"]).type("controller").name("ScheduleAddCtrl").params(["$scope","$state","ScheduleAddService"]).action(function(a,b,c){a.datetodo={dateTime:"",todo:"",remind:0},a.submit=function(){c.save(function(a){b.go("tab.schedule",{})},a.datetodo)}}).build(),(new AppModule).group("app.business.schedule.controller").require(["app.business.schedule.service","app.business.scheduleAdd.controller","app.business.scheduleDetail.controller"]).type("controller").name("ScheduleCtrl").params(["$scope","$state","ScheduleService"]).action(function(a,b,c){var d=(new Date).getMonth(),e=(new Date).getFullYear();a.date=c.getDate(e,d),a.datevalue=new Date,a.dateInfo=function(b,c){var d=new Date(b);d.setDate(c),a.datevalue=d},a.updateValue=function(b){a.datevalue=b;var d=new Date(b),e=d.getMonth(),f=d.getFullYear();a.date=c.getDate(f,e)},a.toDetail=function(){b.go("scheduleAdd")}}).build(),(new AppModule).group("app.business.scheduleDetail.controller").require(["app.business.scheduleDetail.service"]).type("controller").name("ScheduleDetailCtrl").params(["$scope","ScheduleDetailService"]).action(function(a,b){b.get(function(b){a.datetodo=b}),a.toDetail=function(){}}).build(),(new AppModule).group("app.business.scheduleAdd.service").require([]).type("service").name("ScheduleAddService").params(["AppHttpService","AppMessageService"]).action(function(a,b){return{dateTime:"",save:function(c,d){console.log(d);var e=this;a.send({type:"POST",url:"todo/saveSchedule",params:{dateTime:e.dateTime,todo:d.todo,remind:d.remind},onSuccess:function(a){b.appToast({content:"提交成功"}),c(a)},onError:function(){}})}}}).build(),(new AppModule).group("app.business.scheduleDetail.service").require([]).type("service").name("ScheduleDetailService").params(["AppHttpService"]).action(function(a){return{get:function(b){a.send({type:"GET",url:"todo/schedule",params:{},onSuccess:function(a){b(a)},onError:function(){}})}}}).build(),(new AppModule).group("app.business.schedule.service").require([]).type("service").name("ScheduleService").params([]).action(function(){return{getDate:function(a,b){var c=[],d=new Date,e=0;d.setYear(a),d.setMonth(b),d.setDate(1);var f=d.getDay();d.setMonth(b+1),d.setDate(1);for(var g=new Date(d.getTime()-864e5).getDate(),h=0;6>h;h++){for(var i=[],j=0;7>j;j++)0==e&&f>j||e==g?i.push(""):(e++,i.push(e));c.push(i)}return c}}}).build(),(new AppStarter).name("starter").defaultUrl(["msg_tab"]).require(["ionic","app.framework.http.service","app.framework.cache.service","app.framework.listener.service","app.framework.message.service","app.framework.utils.service","app.framework.listPicker.directive","app.business.msg.controller","app.business.schedule.controller","app.business.account.controller","app.business.tab.controller"]).homePartners(["schedule_tab","account_tab"]).listeners({onStateChangeStart:function(a){var b=a.toState.name;b.indexOf("_tab")>=0?a.rootScope.showTab=!0:a.rootScope.showTab=!1},onInit:function(a){},onFinish:function(a){}}).build();